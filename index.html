<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>HBTRK</title>

  <!-- Icône navigateur -->
  <link rel="icon" type="image/png" href="/ico.png">

  <!-- Icône iOS écran d'accueil -->
  <link rel="apple-touch-icon" href="/ico.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="HBTRK">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#080808">
  
  <link rel="stylesheet" href="./dist/style.css">


  <style>
    :root{ --gold:#FFD700; --gold-deep:#C9A227; --bg:#0b0c10; --panel:#0b0c10; --text:#e6eef8; }
    body { background: var(--bg); color: var(--text); }
    .month-grid { grid-template-columns: repeat(3, minmax(0,1fr)); }
    .day-cell { width: 1.6rem; height: 1.6rem; display:flex;align-items:center;justify-content:center;border-radius:.35rem; transition: background-color 0.2s, transform .12s; }
    .day-cell:hover { transform: translateY(-2px); }
    .gold { box-shadow: 0 0 16px rgba(255,215,0,0.35), inset 0 0 0 1px rgba(255,215,0,0.45); border: 1px solid rgba(255,215,0,0.55); }
    .gold-bg { background: linear-gradient(135deg, var(--gold), var(--gold-deep)); padding: .12rem .5rem; border-radius: .45rem; color: #0a0a0a; font-weight:700; box-shadow: 0 0 18px rgba(255,215,0,.28); }
    .gold-chip { background: linear-gradient(135deg, var(--gold), var(--gold-deep)); color:#0a0a0a; font-weight:700; border:1px solid rgba(255,215,0,.55); box-shadow: 0 0 18px rgba(255,215,0,.28); }
    .bar { width: 100%; border-radius: 3px 3px 0 0; background: linear-gradient(180deg, var(--gold), var(--gold-deep)); }
    .bar-muted { background: rgba(255,255,255,.15); }
    .chip { font-size:.75rem; padding:.2rem .5rem; border-radius:.4rem; border:1px solid rgba(255,255,255,.15); display:inline-flex; align-items:center; gap:.3rem; }
    .chip-neutral{ background: rgba(255,255,255,.06); color:#e6eef8; }
    .chip-up{ background: rgba(34,197,94,.15); color:#d1fae5; }
    .chip-down{ background: rgba(239,68,68,.15); color:#fee2e2; }
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:8px}

    .glass { backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); background: linear-gradient(to bottom, rgba(0,0,0,.4), rgba(0,0,0,.18)); border: 1px solid rgba(255,255,255,.08); }

    .streak-badge{ display:inline-flex; align-items:center; justify-content:center; height:44px; width:7ch; border-radius:999px; font-weight:700; font-size:.9rem; line-height:1; border:0px solid rgba(255,255,255,.18); color: rgba(255,255,255,.9); overflow:hidden; white-space:nowrap; }
    .streak-badge--best{ background: linear-gradient(135deg, var(--gold), var(--gold-deep)); color:#0a0a0a; border-color: rgba(255,215,0,.55); box-shadow: 0 0 18px rgba(255,215,0,.28); }
  </style>
</head>
<body class="antialiased min-h-screen">
  <header class="fixed top-0 left-0 right-0 z-40 backdrop-blur-md bg-gradient-to-b from-black/40 to-transparent border-b border-white/5">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2 sm:gap-4">
        <button id="appTitle" class="text-lg font-extrabold tracking-wide hover:opacity-80">HBTRK</button>
      </div>
      <div class="flex items-center gap-3">
        <button id="addHabitBtn" class="text-sm bg-white/10 px-3 py-1 rounded-full hover:bg-white/15">+ Habitude</button>
        <button id="burgerBtn" aria-label="Menu"
                class="h-7 w-12 grid place-items-center rounded-full bg-white/10 hover:bg-white/15 border border-white/10 transition active:scale-95">
          <svg id="burgerIcon" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg id="closeIcon" class="hidden" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main id="homePage" class="pt-20 pb-24 max-w-5xl mx-auto px-4 space-y-10 overflow-auto" style="scroll-behavior: smooth;"></main>

  <div id="dayOverlay" class="hidden fixed inset-0 z-40 bg-black/30"></div>

  <div id="dayPanel"
    class="hidden md:block fixed right-4 top-20 z-50 w-192 max-w-full glass rounded-2xl shadow-2xl p-4 transition-transform duration-300 overflow-y-auto will-change-transform"
    style="max-height: calc(100vh - 6rem); transform: translateX(calc(100% + 1rem)); visibility: hidden;">
    <div class="flex items-start justify-between mb-3">
      <div>
        <div id="panelDate" class="text-sm font-semibold">Jour</div>
        <div id="panelDateLong" class="text-xs text-white/60">date</div>
      </div>
      <button id="closePanel" class="hidden text-sm px-2 py-1 rounded hover:bg-white/5">Fermer</button>
    </div>
    <div id="habitsList" class="space-y-3 max-h-144 overflow-auto pb-2"></div>
  </div>

  <section id="dayPage" class="hidden pt-20 pb-32 max-w-2xl mx-auto px-4 min-h-screen flex flex-col">
    <div class="text-center mb-4">
      <div id="dayTitle" class="text-5xl font-extrabold pt-16 pb-4"></div>
      <div id="dayTitleSub" class="text-sm text-white/60"></div>
    </div>
    <div id="dayContent" class="flex-1"></div>
    <div id="dayHabitsList" class="mb-4 space-y-3 flex flex-col items-center"></div>
    
    <!-- Barre de navigation fixée en bas -->
    <div class="fixed bottom-0 left-0 right-0 z-50 flex items-center justify-center py-4">
      <div class="flex items-center gap-1 rounded-full border border-white/10 bg-white/5 backdrop-blur px-1.5 py-1 shadow-lg">
        <button id="prevDay" aria-label="Jour précédent" class="h-11 w-11 sm:h-10 sm:w-10 grid place-items-center rounded-full hover:bg-white/10 active:scale-95 transition focus:outline-none focus:ring-2 focus:ring-white/20">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button id="todayBtn" class="h-11 sm:h-10 px-4 sm:px-5 rounded-full font-semibold text-xs bg-[rgb(0,200,75)] text-black border border-green-400/40 ring-1 ring-green-300/30 hover:brightness-95 active:scale-95 transition focus:outline-none focus:ring-2 focus:ring-green-300/50 flex items-center gap-2">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" opacity=".7"/><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="1.5" fill="currentColor"/></svg>
          <span>Aujourd'hui</span>
        </button>
        <button id="nextDay" aria-label="Jour suivant" class="h-11 w-11 sm:h-10 sm:w-10 grid place-items-center rounded-full hover:bg-white/10 active:scale-95 transition focus:outline-none focus:ring-2 focus:ring-white/20">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
    </div>
  </section>

  <!-- Modal Add Habit avec fréquence -->
  <div id="modalAddHabit" class="fixed inset-0 z-60 hidden items-center justify-center bg-black/50" role="dialog" aria-modal="true">
    <div class="glass rounded-xl p-4 w-96 shadow-2xl">
      <h3 class="font-semibold mb-2">Ajouter une habitude</h3>

      <!-- Nom -->
      <input id="habitNameInput"
        class="w-full py-2 px-4 rounded-full bg-white/10 border border-white/10 mb-2"
        placeholder="Nom de l'Habitude"/>

      <!-- Date de début -->
      <label class="block text-xs text-white/60 mb-2">Active à partir de :</label>
      <input id="habitStartInput" type="date"
        class="w-full py-2 px-4 rounded-full bg-white/10 border border-white/10 mb-4" />

      <!-- Fréquence -->
      <div class="mb-4">
        <div class="text-xs text-white/60 mb-2 font-semibold">Fréquence :</div>

        <!-- MODE A : Hebdomadaire -->
        <div id="freqWeeklyBlock"
          class="mb-3 p-3 rounded-lg border border-white/10 bg-white/5">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm font-semibold">Hebdomadaire</div>
            <input id="freqWeeklyRadio" type="radio" name="freqMode" value="weekly"
              class="w-4 h-4 accent-[rgb(0,200,75)]">
          </div>

<div id="weeklyDaysRow" class="flex gap-1">
  <button data-dow="1" class="dayToggle flex-1 py-2 text-xs rounded-md font-semibold border-green-400/40 bg-[rgb(0,200,75)] text-black">L</button>
  <button data-dow="2" class="dayToggle flex-1 py-2 text-xs rounded-md font-semibold border-green-400/40 bg-[rgb(0,200,75)] text-black">M</button>
  <button data-dow="3" class="dayToggle flex-1 py-2 text-xs rounded-md font-semibold border-green-400/40 bg-[rgb(0,200,75)] text-black">M</button>
  <button data-dow="4" class="dayToggle flex-1 py-2 text-xs rounded-md font-semibold border-green-400/40 bg-[rgb(0,200,75)] text-black">J</button>
  <button data-dow="5" class="dayToggle flex-1 py-2 text-xs rounded-md font-semibold border-green-400/40 bg-[rgb(0,200,75)] text-black">V</button>
  <button data-dow="6" class="dayToggle flex-1 py-2 text-xs rounded-md font-semibold border-green-400/40 bg-[rgb(0,200,75)] text-black">S</button>
  <button data-dow="0" class="dayToggle flex-1 py-2 text-xs rounded-md font-semibold border-green-400/40 bg-[rgb(0,200,75)] text-black">D</button>
</div>


          <div class="text-[10px] text-white/40 mt-2">
            Choisis les jours où l'habitude apparaît.
          </div>
        </div>

        <!-- MODE B : Tous les X jours -->
        <div id="freqIntervalBlock"
          class="mb-3 p-3 rounded-lg border border-white/10 bg-white/5">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm font-semibold">Tous les X jours</div>
            <input id="freqIntervalRadio" type="radio" name="freqMode" value="interval"
              class="w-4 h-4 accent-[rgb(0,200,75)]">
          </div>

          <div class="flex items-center gap-2">
            <input id="everyXDaysInput" type="number" min="1"
              class="w-16 py-2 px-3 rounded-md bg-white/10 border border-white/10 text-sm"
              value="3">
            <div class="text-xs text-white/80">Répéter tous les X jours</div>
          </div>

          <div class="text-[10px] text-white/40 mt-2">
            Apparaît le jour de départ, puis à nouveau après X jours, etc.
          </div>
        </div>

        <!-- MODE C : Le X du mois -->
        <div id="freqMonthlyBlock"
          class="mb-4 p-3 rounded-lg border border-white/10 bg-white/5">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm font-semibold">Chaque mois le…</div>
            <input id="freqMonthlyRadio" type="radio" name="freqMode" value="monthly"
              class="w-4 h-4 accent-[rgb(0,200,75)]">
          </div>

          <div class="flex items-center gap-2">
            <input id="dayOfMonthInput" type="number" min="1" max="31"
              class="w-16 py-2 px-3 rounded-md bg-white/10 border border-white/10 text-sm"
              value="1">
            <div class="text-xs text-white/80">… du mois</div>
          </div>

          <div class="text-[10px] text-white/40 mt-2">
            Si le mois n’a pas ce jour (ex: 31), l’habitude n’apparaît pas.
          </div>
        </div>
      </div>

      <!-- Boutons Annuler / Ajouter -->
      <div class="flex justify-end gap-2">
        <button id="cancelAddHabit"
          class="px-3 py-1 rounded-full hover:bg-white/5">
          Annuler
        </button>
        <button id="confirmAddHabit"
          class="px-3 py-1 bg-white/10 rounded-full hover:bg-white/15">
          Ajouter
        </button>
      </div>
    </div>
  </div>

  <div id="modalMonth" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 p-4">
    <div class="glass rounded-2xl p-4 w-full max-w-2xl max-h-[85vh] overflow-auto">
      <div class="flex items-center justify-between mb-2">
        <div class="font-bold" id="monthModalTitle">Mois</div>
        <button id="closeMonth" class="px-2 py-1 rounded hover:bg-white/5">Fermer</button>
      </div>
      <p class="text-xs text-white/60 mb-3">Taux de complétion du mois sélectionné et des <span class="font-semibold">2 mois précédents</span>…</p>
      <div id="monthSummary" class="space-y-2"></div>
    </div>
  </div>

  <div id="modalYear" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 p-4">
    <div class="glass rounded-2xl p-4 w-full max-w-3xl max-h-[85vh] overflow-auto">
      <div class="flex items-center justify-between mb-2">
        <div class="font-bold" id="yearModalTitle">Année</div>
        <button id="closeYear" class="px-2 py-1 rounded hover:bg-white/5">Fermer</button>
      </div>
      <p class="text-xs text-white/60 mb-3">Taux de complétion <span class="font-semibold">mensuel</span>…</p>
      <div id="yearSummary" class="space-y-3"></div>
    </div>
  </div>

  <!-- Modal Installation -->
  <div id="modalInstall" class="fixed inset-0 z-60 hidden items-center justify-center bg-black/50 p-4">
    <div class="glass rounded-2xl p-5 w-full max-w-md shadow-2xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-lg">Installer l'application</h3>
        <button id="closeInstall" class="px-2 py-1 rounded hover:bg-white/5">×</button>
      </div>
      
      <div class="space-y-4">
        <div>
          <h4 class="font-semibold mb-2 text-sm">📱 iOS (Safari)</h4>
          <p class="text-xs text-white/80">Sur iPhone ou iPad, appuie sur le bouton de partage en bas de l'écran puis choisis "Sur l'écran d'accueil".</p>
        </div>
        
        <div>
          <h4 class="font-semibold mb-2 text-sm">🤖 Android (APK)</h4>
          <p class="text-xs text-white/80 mb-2">Tu peux aussi installer la version complète en téléchargeant le fichier HBTRK.apk ici :</p>
          <a href="./HBTRK.apk" class="inline-block px-4 py-2 bg-white/10 hover:bg-white/15 rounded-full text-sm border border-white/10">Télécharger l'APK</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay du menu -->
  <div id="navOverlay" class="hidden fixed inset-0 z-40 bg-black/30"></div>

  <!-- Panneau menu -->
  <div id="navPanel"
       class="hidden fixed right-4 top-20 z-50 w-64 max-w-full glass rounded-2xl shadow-2xl p-3 transition-transform duration-300 overflow-y-auto will-change-transform"
       style="max-height: calc(100vh - 6rem); transform: translateX(calc(100% + 1rem)); visibility: hidden;">

    <div id="userBadge" class="hidden mb-3">
      <span class="chip chip-neutral">
        <span id="userNamePart">—</span>
      </span>
    </div>

    <div class="space-y-2">
      <button id="menuImport" class="w-full text-left px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10">
        Importer
      </button>
      <button id="menuExport" class="w-full text-left px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10">
        Exporter
      </button>
      <button id="menuInstall" class="w-full text-left px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10">
        Installer l'application
      </button>
      <a href="https://example.com/donate" target="_blank" class="block w-full text-left px-3 py-2 rounded-lg gold-bg border border-white/10 ">
        Faire un don
      </a>
      <a href="mailto:naim.benkherouf@gmail.com" class="block w-full text-left px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10">
        Contactez-moi
      </a>
      <button id="menuLogout" class="w-full text-left px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10">
        Se déconnecter
      </button>
    </div>

  </div>

  <input id="fileInput" type="file" accept="application/json" class="hidden" />

  <!-- Modale Auth -->
  <div id="authModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/60">
    <div class="glass w-full max-w-sm mx-4 rounded-2xl p-5 shadow-2xl">
      <h2 class="text-xl font-extrabold mb-3 text-center">Connexion</h2>
      <p class="text-xs text-white/60 mb-4 text-center">Connecte-toi pour accéder à tes données.</p>

      <div class="space-y-2">
        <input id="authEmail" type="email" autocomplete="email"
              class="w-full py-2 px-4 rounded-full bg-white/10 border border-white/10"
              placeholder="Email">
        <input id="authPassword" type="password" autocomplete="current-password"
              class="w-full py-2 px-4 rounded-full bg-white/10 border border-white/10"
              placeholder="Mot de passe">
      </div>

      <div class="text-center mt-2">
        <button id="forgotPassword" class="text-xs text-white/60 hover:text-white/90">Mot de passe oublié ?</button>
      </div>

      <div id="authError" class="text-xs text-red-300 mt-2 min-h-[1rem]"></div>

      <div class="flex justify-between items-center mt-4">
        <button id="authCreate" class="text-sm px-3 py-1 rounded-full hover:bg-white/5">Créer un compte</button>
        <button id="authSubmit" class="text-sm px-4 py-1 rounded-full bg-white/10 hover:bg-white/15">Se connecter</button>
      </div>
    </div>
  </div>
  <script type="module" src="./app.js"></script>
</body>
</html>